{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="float-end">
				<button type="submit" form="form-module" data-bs-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
				<a href="{{ cancel }}" data-bs-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-secondary"><i class="fa fa-reply"></i></a>
				<span type="button" class="btn-divider">&nbsp;</span>
				<div class="btn-group" data-bs-toggle="tooltip" title="{{ button_modules }}">
					<a href="{{ modules_link }}" class="btn btn-success">{{ button_modules }}</a>
					<button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
						<span class="visually-hidden">Toggle Dropdown</span>
					</button>
					<ul class="dropdown-menu">
						<li><a class="dropdown-item" href="{{ add_module }}">{{ button_add }}</a></li>
						{% if (modules is not empty) %}
						<li><hr class="dropdown-divider"></li>
						<li><h6 class="dropdown-header">{{ button_modules }}</h6></li>
						{% for module in modules %}
						<li><a class="dropdown-item" href="{{ module.edit }}">{{ module.name }}</a></li>
						{% endfor %}
						{% endif %}
					</ul>
				</div>
				<div class="btn-group" data-bs-toggle="tooltip" title="{{ text_list }}">
					<a href="{{ list }}" class="btn btn-success">{{ text_list }}</a>
					<button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
						<span class="visually-hidden">Toggle Dropdown</span>
					</button>
					<ul class="dropdown-menu">
						<li><a class="dropdown-item" href="{{ add_block }}">{{ button_add }}</a></li>
						{% if (htmls_top is not empty) %}
						<li><hr class="dropdown-divider"></li>
						<li><h6 class="dropdown-header">{{ text_list }}</h6></li>
						{% for html in htmls_top %}
						<li><a class="dropdown-item" href="{{ html.edit }}">{{ html.name }}</a></li>
						{% endfor %}
						{% endif %}
					</ul>
				</div>
			</div>
			<h1>{{ heading_title }}</h1>
			<ol class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
					<li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ol>
		</div>
	</div>
	<div class="container-fluid">
		{% if error_warning %}
			<div class="alert alert-danger alert-dismissible"><i class="fas fa-exclamation-circle"></i> {{ error_warning }}
				<button type="button" class="btn-close float-end" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		{% endif %}
		{% if success %}
		<div class="alert alert-success"><i class="fas fa-check-circle"></i> {{ success }}
			<button type="button" class="btn-close float-end" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		{% endif %}
		<style>
		html {
			overflow-y: scroll;
		}
		.input-code {
			min-height: 250px;
		}
		.btn-divider {
			display: inline-block;
			width: 1px;
			padding: 7px 0px;
			margin: 0px 5px;
			background: #cdcdcd;
			border: none;
		}
		.form-group .ui-switcher {
			margin-top: 9px;
		}
		#content .dropdown-toggle::after {
			display: inline-block;
			vertical-align: 0.155em;
			content: "";
			border-top: 0.355em solid;
			border-right: 0.355em solid transparent;
			border-bottom: 0;
			border-left: 0.355em solid transparent;
		}
		</style>
		<div class="card">
			<div class="card-header"><i class="fas fa-list"></i> {{ text_edit }}<span class="float-end">v{{ version }}</span></div>
			<div class="card-body">
				<div class="menu-manager-container">
					<form action="{{ save }}" method="post" enctype="multipart/form-data" id="form-module" class="form-horizontal">
						
						<div class="row mb-3 required">
							<label class="col-sm-2 col-form-label" for="input-name">{{ entry_name }}</label>
							<div class="col-sm-10">
								<input type="text" name="name" id="input-name" class="form-control" value="{{ name }}" placeholder="{{ entry_name }}">
								{% if error_name %}
									<div class="text-danger">{{ error_name }}</div>
								{% endif %}
							</div>
						</div>
					
						<div class="row mb-3">
							<label class="col-sm-2 col-form-label" for="input-status">{{ entry_status }}</label>
							<div class="col-sm-10">
								<input type="checkbox" class="switcher ui-switcher form-control" data-target="hidden-status" {{ (status == 1) ? 'checked' : '' }}>
								<input type="hidden" id="hidden-status" name="status" value="{{ status }}">
							</div>
						</div>

						<div class="row mb-3">
							<label class="col-sm-2 col-form-label" for="input-sort-order">{{ entry_sort_order }}</label>
							<div class="col-sm-10">
								<input type="text" name="sort_order" id="input-sort-order" class="form-control" value="{{ sort_order }}" placeholder="{{ entry_sort_order }}">
							</div>
						</div>

						<ul class="nav nav-tabs" id="language" role="tablist">
							{% for language in languages %}
							<li class="nav-item" role="presentation">
								<a href="#language{{ language.language_id }}" data-bs-toggle="tab" class="nav-link">
									<img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /> {{ language.name }}
								</a>
							</li>
							{% endfor %}
						</ul>

						<div class="tab-content">
							{% for language in languages %}
							<div class="tab-pane" id="language{{ language.language_id }}">

								<div class="row mb-3">
									<label class="col-sm-2 col-form-label" for="input-code-{{ language.language_id }}">{{ entry_code_block }}</label>
									<div class="col-sm-10">
										<pre id="input-code-{{ language.language_id }}" class="input-code"></pre>
										<input type="hidden" name="code[{{ language.language_id }}]" id="hidden-code-{{ language.language_id }}" value="{{ code[language.language_id] }}">
									</div>
								</div>

							</div>
							{% endfor %}
						</div>
					
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/ace.min.js" integrity="sha512-U2JKYiHG3ixOjmdycNbi4Xur8q4Nv73CscCGEopBeiVyzDR5ErC6jmHNr0pOB8CUVWb0aQXLgL0wYXhoMU6iqw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
{% for language in languages %}
let jsEditorWrapper{{ language.language_id }};
let jsEditor{{ language.language_id }};
{% endfor %}
$(document).ready(function() {

	window.ace.config.set('basePath', 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.9.6/');
	{% for language in languages %}
	jsEditorWrapper{{ language.language_id }} = document.querySelector('#input-code-{{ language.language_id }}');
	jsEditor{{ language.language_id }} = window.ace.edit(jsEditorWrapper{{ language.language_id }});
	jsEditor{{ language.language_id }}.setTheme('ace/theme/textmate');
	jsEditor{{ language.language_id }}.session.setMode('ace/mode/html');

	jsEditor{{ language.language_id }}.setValue($('#hidden-code-{{ language.language_id }}').val(), -1);
	jsEditor{{ language.language_id }}.focus();
	{% endfor %}

	$('#form-module').on('submit', function(e) {
		{% for language in languages %}
		$('#hidden-code-{{ language.language_id }}').val(jsEditor{{ language.language_id }}.getValue());
		{% endfor %}
		return true;
	});

	$('.switcher').on('change', function(e) {
		$('#' + $(e.target).data('target')).val(Number($(e.target).prop('checked')));
	});

	$('#language a:first').tab('show');

	$.switcher('input[type=checkbox].switcher');

	$('[data-countdown]').each(function(index, value) {
		let tid = setInterval(() => {
			let current = parseInt($(value).find('.countdown').text().match(/(\d+)/));
			$(value).find('.countdown').text('[' + (current - 1) + ']');
			if (current == 1) {
				clearInterval(tid);
				$(value).remove();
			}
		}, 1000);
	});

});
</script>
{{ footer }}